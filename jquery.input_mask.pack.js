(function(h){function i(a,c){this.obj=a;this.options=c;this.mask=this.obj.data("mask")||c.mask;this.editablePos=[];this.strType=["w","d"];this.preventCode=[37,39,8];this.placeholder=this.obj.data("placeholder")||c.placeholder;this.rusMoreLetters=[186,188,190,191,192,219,221,222];this.regExpFromMask=this.generateRegExp();this.parseMask();this.obj.val(this.placeholder?this.placeholder:this.mask);this.events()}h.fn.inputMask=function(a){return this.each(function(){var c=h(this);c.data("masked")||c.data(new i(c,
a))})};String.prototype.setCharAt=function(a,c){return a>this.length-1?str:this.substr(0,a)+c+this.substr(a+1)};var g=i.prototype;g.events=function(){var a=this;this.obj.bind("keydown",function(c){-1!=h.inArray(c.keyCode,a.preventCode)&&c.preventDefault();setTimeout(function(){a.bindKeyPress(c,a.charCode)},10)});this.obj.bind("keypress",function(c){a.charCode=c.charCode||c.keyCode;c.preventDefault()});this.obj.bind("blur",function(){a.placeholder&&!a.obj.val().match(a.regExpFromMask)&&a.obj.val(a.placeholder)});
this.obj.bind("focus",function(){a.obj.val(a.mask);a.setCursorPosition(0)})};g.generateRegExp=function(){var a;a=this.mask.replace(/\{(\w)(\d)(?=\})\}/gi,"\\$1{$2}");return a=a.replace(/([.*+?^$()|[\]\/])/g,"\\$1")};g.bindKeyPress=function(a,c){var b=a.which||a.keyCode,e=this.getCursorPosition(),d=0,f;if(!(10<=b&&32>b||32<b&&37>b||40<b&&45>b||112<=b&&145>=b)){if(37==b||39==b)e=37==b?e-1:e+1,this.setCursorPosition(e);d=8==b?-1:1;if(!(1==d&&e>this.mask.length)){for(;"-"==this.editablePos[1==d?e:e-1];)e+=
d;f=1==d?e:e-1;if("-"!=this.editablePos[f])if("d"==this.editablePos[f])if(48<=b&&57>=b||96<=b&&105>=b)this.mask=this.mask.setCharAt(f,String.fromCharCode(c));else if(8==b&&0<=f)this.mask=this.mask.setCharAt(f,"_");else return!0;else if("w"==this.editablePos[f])if(65<=b&&89>=b||-1!=h.inArray(b,this.rusMoreLetters))this.mask=this.mask.setCharAt(f,String.fromCharCode(c));else if(8==b&&0<=f)this.mask=this.mask.setCharAt(f,"_");else return!0;this.obj.val(this.mask);this.setCursorPosition(e+d)}}};g.parseMask=
function(){var a=[],c=0,b="s";if(matches=this.mask.match(/\{(.*?)(?=\})\}/gi)){for(var e=matches.length,d=0;d<e;d++){c=parseInt(matches[d].substring(2,3));c=parseInt(0==c?1:c);for(b=matches[d].substring(1,2);c--;)a.push(b);this.mask=this.mask.replace(matches[d],a.join(""));a=[]}this.editablePos=Array(this.mask.length+1).join("-").split("");a=this.mask.split("");c=[];e=a.length;for(d=0;d<e;d++)b=a[d],-1!=h.inArray(a[d],this.strType)&&(b="_",this.editablePos[d]=a[d]),c.push(b);this.mask=c.join("")}};
g.getCursorPosition=function(){var a=0,c=this.obj.get(0),b;if(document.selection)c.focus(),a=document.selection.createRange(),b=document.selection.createRange().text.length,a.moveStart("character",-c.value.length),a=a.text.length-b;else if(c.selectionStart||"0"==c.selectionStart)a=c.selectionStart;return a};g.setCursorPosition=function(a){return this.setSelection(a,a)};g.setSelection=function(a,c){var b=this.obj.get(0);b.setSelectionRange?(b.focus(),b.setSelectionRange(a,c)):b.createTextRange&&(b=
b.createTextRange(),b.collapse(!0),b.moveEnd("character",c),b.moveStart("character",a),b.select())}})(jQuery);